---
title: "Assignment 1 — Matching Pennies: Strategies, Tournament, and Stan"
format:
  html:
    toc: true
    number-sections: true
execute:
  echo: false
  warning: false
  message: false
---

## Overview

This assignment compares three **Stan-parameterised** strategy families in repeated Matching Pennies:

- `StanRandom`: action probability *p* is drawn from a Stan prior (agent-to-agent heterogeneity).
- `WSLS(Stan)`: win–stay/lose–shift with lapse, all parameters drawn from a Stan prior.
- `kToM(Stan,k=2)`: a compact k-level theory-of-mind heuristic with mixture weights updated online; parameters drawn from a Stan prior.

Stan is used in two roles: (i) sampling priors to instantiate many agents, and (ii) fitting a WSLS policy model to simulated sequences.

## Methods

Tournament design:

- Each matchup is simulated many times (fresh agents per simulation).
- Each simulation plays *T=60* rounds.
- Roles are swapped halfway (A as Matcher → A as Mismatcher), allowing a direct role-sensitivity diagnostic.
- The main outcome is the total payoff of the row player (A) across rounds.

Uncertainty:

- For each matchup, we report the empirical mean and a 95% interval (2.5%–97.5%) across simulations.

## Results

### 1) Matchup bars with uncertainty

![](figs/matchup_bars.png)

Interpretation:
- `StanRandom` serves as a neutral baseline with wide variability.
- `WSLS(Stan)` tends to exploit systematic deviations from perfect mixing when the opponent is not fully random; however, it can be exploitable if its “stay/shift” tendencies become predictable.
- `kToM(Stan)` can outperform simple heuristics when the opponent exhibits structure, because it adaptively re-weights opponent models based on predictive success. Against near-random opponents, its advantage is limited.

### 2) Role-swap swing (Matcher vs Mismatcher)

![](figs/role_swap_swing.png)

Interpretation:
- The swing isolates whether a strategy is intrinsically better as Matcher or as Mismatcher.
- Large positive swings indicate a strategy gains substantially from being the Matcher (e.g., by stabilising on “match” patterns).
- Near-zero swings suggest role-robustness, consistent with strategies that approximate mixed play.

### 3) Stan posterior for WSLS parameters

We fit the WSLS policy model to WSLS-generated sequences (WSLS vs StanRandom), then inspect the posterior.

![](figs/stan_posterior_wsls.png)

Interpretation:
- If the posterior for `p_repeat_win` is clearly above 0.5, it supports strong win-stay.
- If `p_repeat_loss` is clearly below 0.5, it supports lose-shift.
- A non-trivial `lapse` mass away from 0 implies occasional random responding is needed to explain the sequences (or to avoid predictability).

### 4) Payoff distribution (optional)

![](figs/payoff_distribution.png)

Interpretation:
- Wide or multi-modal distributions indicate substantial simulation-to-simulation variability (parameter heterogeneity + stochastic play).
- Narrow distributions suggest a matchup outcome is robust to parameter draws.

## Conclusion

The tournament shows that **adding latent structure via Stan priors** produces meaningful between-agent variability, and that strategy performance depends on both opponent structure and role. `WSLS(Stan)` captures a compact reinforcement heuristic, while `kToM(Stan)` adds a minimal adaptive modelling layer; this can improve performance when opponents deviate from random mixing, but offers limited gains against near-random play. The WSLS posterior plot provides a clean bridge between the agent-level generative story and statistical inference: the fitted parameters recover the qualitative “stay after win, switch after loss” pattern, moderated by lapse to account for residual randomness and unpredictability.
