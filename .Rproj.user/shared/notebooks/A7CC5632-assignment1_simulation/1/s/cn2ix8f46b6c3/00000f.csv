"0","simulate_match <- function(agent_A, agent_B, n_trials = 60, swap_at = 30) {"
"0","  stopifnot(swap_at >= 1, swap_at <= n_trials)"
"0",""
"0","  agent_A$init()"
"0","  agent_B$init()"
"0",""
"0","  role_A <- c(rep(""matcher"", swap_at), rep(""hider"", n_trials - swap_at))"
"0","  role_B <- ifelse(role_A == ""matcher"", ""hider"", ""matcher"")"
"0",""
"0","  out <- vector(""list"", n_trials)"
"0",""
"0","  for (t in seq_len(n_trials)) {"
"0","    a <- agent_A$act(role_self = role_A[t], role_opp = role_B[t])"
"0","    b <- agent_B$act(role_self = role_B[t], role_opp = role_A[t])"
"0",""
"0","    payoff_A <- if (role_A[t] == ""matcher"") {"
"0","      if (a == b) 1L else -1L"
"0","    } else {"
"0","      if (a != b) 1L else -1L"
"0","    }"
"0","    payoff_B <- -payoff_A"
"0",""
"0","    agent_A$learn(own_action = a, opp_action = b, payoff = payoff_A, role_self = role_A[t], role_opp = role_B[t])"
"0","    agent_B$learn(own_action = b, opp_action = a, payoff = payoff_B, role_self = role_B[t], role_opp = role_A[t])"
"0",""
"0","    out[[t]] <- data.frame("
"0","      trial = t,"
"0","      role_A = role_A[t],"
"0","      role_B = role_B[t],"
"0","      action_A = a,"
"0","      action_B = b,"
"0","      payoff_A = payoff_A,"
"0","      payoff_B = payoff_B"
"0","    )"
"0","  }"
"0",""
"0","  bind_rows(out)"
"0","}"
